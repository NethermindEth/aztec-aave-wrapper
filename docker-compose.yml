# Docker Compose configuration for Aztec Aave Wrapper local development
#
# Uses `aztec start --local-network` which includes:
# - Internal Anvil L1 (exposed on port 8545)
# - Aztec PXE (exposed on port 8080)
# - Pre-deployed Aztec protocol contracts
# - Test accounts with funds

services:
  # ============================================================================
  # Aztec Local Network - Complete development environment
  # Includes internal Anvil L1, PXE, sequencer, and pre-deployed contracts
  # ============================================================================
  aztec-sandbox:
    image: aztecprotocol/aztec:${AZTEC_VERSION:-latest}
    container_name: aztec-aave-sandbox
    ports:
      # PXE HTTP endpoint
      - "${PXE_PORT:-8080}:8080"
      # Internal Anvil L1 endpoint
      - "${ANVIL_L1_PORT:-8545}:8545"
    environment:
      # Sandbox mode settings
      AZTEC_NODE_NO_LOGS: ${AZTEC_NODE_NO_LOGS:-false}
      # Debug logging (set to empty for less verbose)
      DEBUG: ${AZTEC_DEBUG:-aztec:*}
      # PXE configuration
      PXE_PROVER_ENABLED: ${PXE_PROVER_ENABLED:-false}
    # Start local network - includes internal Anvil L1
    entrypoint: ["/bin/bash", "-c", "node --no-warnings /usr/src/yarn-project/aztec/dest/bin/index.js start --local-network"]
    healthcheck:
      # Check PXE is responding
      test: ["CMD-SHELL", "curl -sf http://localhost:8080/status || exit 1"]
      interval: 10s
      timeout: 30s
      retries: 60
      start_period: 120s
    restart: unless-stopped

# ============================================================================
# Volumes (optional - for persistence)
# ============================================================================
volumes:
  aztec-data:
    name: aztec-aave-data
